import pyperclip
import requests
import pyperclip
import os
def capital_trend():

    ticker = ""

    input = pyperclip.paste().split('\n')

    a_string = ''
    b_string = ''

    for i in input:
        if "{" not in i:
            ticker = i.strip()
        else:
            list = i.split('\t')
            a_string = f"{a_string}{list[0]}\n"
            b_string = f"{b_string}{list[1]}\n"

    html_content = """
<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LYVSDS633M"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LYVSDS633M');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>@replace_with_ticker Capital Trend</title>
<link rel="icon" type="image/x-icon" href="favicon_1.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="chart-styles.css">
</head>
<body>
<section>
<img id="site-logo" src="regentquant-logo-two-colors.svg">
<h1 class="chart-title">Regentquant @replace_with_ticker Capital Trend</h1>
<h2 class="go-back-to-home-screen"><a href="https://www.regentquant.com">Go Back To Home Screen</a></h2>
<h2>How to use: Investors can predict future price trend by looking at capital trend. Candlestick chart shows underlying stock's historical adjusted OHLC price. Line chart shows daily block order amount (Unit$). Here block order stands for the largest 30% of orders in terms of turnover over the past 200 days. The data is estimated by algorithm and for reference only.</h2>
<button id="download-chart">Save Chart</button>
</section>
<!-- Fund NAV Chart -->
<div id="container"></div>
<section id="footer"></section>
<script type="text/javascript">
// Lightweight Charts™ Example: Two Price Scales
// https://tradingview.github.io/lightweight-charts/tutorials/how_to/two-price-scales
const chartOptions = {
rightPriceScale: {
visible: true,
},
leftPriceScale: {
visible: true,
},
layout: {
textColor: 'black',
background: { type: 'solid', color: 'white' },
},
crosshair: {
mode: 0, // CrosshairMode.Normal
},
};
/** @type {import('lightweight-charts').IChartApi} */
const chart = LightweightCharts.createChart(document.getElementById('container'), chartOptions);
const baselineSeries = chart.addBaselineSeries({ baseValue: { type: 'price', price: 0 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba( 38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 239, 83, 80, 1)', bottomFillColor1: 'rgba( 239, 83, 80, 0.05)', bottomFillColor2: 'rgba( 239, 83, 80, 0.28)' });
const data = [@REPLACE_A];
baselineSeries.setData(data);
const candlestickSeries = chart.addCandlestickSeries({
priceScaleId: 'left',
upColor: '#26a69a', downColor: '#ef5350', borderVisible: false,
wickUpColor: '#26a69a', wickDownColor: '#ef5350',
});
candlestickSeries.setData([@REPLACE_B]);
chart.timeScale().fitContent();
chart.applyOptions({
layout: {
fontFamily: "'Saira Condensed', sans-serif",
},
});
window.addEventListener('resize', resizeChart);
function resizeChart() {
const container = document.getElementById('container');
chart.resize(
container.offsetWidth,
container.offsetHeight
);
}
resizeChart();
document.getElementById('download-chart').addEventListener('click', function() {
const chartContainer = document.getElementById('container');
html2canvas(chartContainer, {
scale: 5  // Increase this value for higher resolution
}).then(canvas => {
const link = document.createElement('a');
link.href = canvas.toDataURL('image/png');
link.download = 'chart_high_res.png';
link.click();
});
});
</script>
</body>
</html>
""".replace("@REPLACE_A",a_string).replace("@REPLACE_B",b_string).replace("@replace_with_ticker", ticker.upper())
    file_path = f'capital-trend-{ticker}.html'

    # Writing the HTML content to the file
    with open(file_path, 'w') as file:
        file.write(html_content)

    file.close()
    print(ticker)

api_key = "ezBrk47F0tOiUtSZU7KevlNnxEEwPgIs"
data = '''Date	STOCK:NVDA	STOCK:TSLA	STOCK:AAPL	STOCK:AMZN	STOCK:META	STOCK:NFLX	STOCK:GOOGL	STOCK:SNOW	STOCK:AVGO	STOCK:AMD
2023-01-03	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00
2023-01-04	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00
2023-01-05	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00
2023-01-06	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00	0.00
2023-01-09	10937485	14741917	-206536941	-9589317	376673552	369741023	-102064151	-63074159	263912912	-48754208
2023-01-10	239267412	154185706	-44911769	71635269	402949481	772847435	-139215314	32158133	101730804	97337442
2023-01-11	47527531	35975373	14212896	261225870	240298309	363587225	22186494	166980805	-29381875	111071245
2023-01-12	230961034	5868030	57950613	278138923	379184190	23563393	11198386	267096226	102026521	168128466
2023-01-13	209417588	-91003503	15955627	282235458	397627803	141406940	71514433	151947558	-208151079	112616547
2023-01-17	304324892	1986528	3215625	18746134	147328556	-194457973	-120593933	122404370	-325617933	156789221
2023-01-18	123670078	-177670706	-45466194	-77337409	-54619747	-585771747	-249857939	20372810	-125301781	35150073
2023-01-19	75558680	-247440674	-98423792	-278849283	112060293	-622190150	-217361742	-84801091	-205905245	-88019148
2023-01-20	235372908	-134872000	-79990396	-185493654	151881947	-243462166	50106187	-13807418	-269982354	-42664000
2023-01-23	338228084	-52886963	-43478983	-259207166	166776064	-129164708	174256390	128397395	-33935433	101806086
2023-01-24	201765315	-168836775	27252392	-135717532	352676240	311684455	213294094	3763956	19836865	-62929014
2023-01-25	262613113	56620981	34835985	-86963304	296822403	353137523	161313791	-6361334	11277360	10152785
2023-01-26	484614775	78814091	43734735	45090188	270673958	375819322	117891537	120957790	271473565	19518624
2023-01-27	390690342	370297420	207247783	119296694	265248717	34051032	89721656	147157785	176725353	49057172
2023-01-30	93827776	-108793165	36196937	63695449	-36127700	-365556847	-148358246	12837915	-33279580	-118282108
2023-01-31	165489163	19582671	-23668937	226288108	-34696240	-558301461	24421234	113828409	34717742	42512171
2023-02-01	312273416	50088908	-10840513	163243506	168181810	-302110740	119981492	231257309	182996553	97982941
2023-02-02	308058760	52476130	-143038407	124505189	119852970	58306747	129654747	275186408	159046218	214375100
2023-02-03	224009487	-255722844	-52486969	28293780	107457079	375333909	114078812	139653740	180436206	153445930
2023-02-06	464918718	119513651	-90572015	38427090	359552215	332994234	144912439	113728976	339857792	160948705
2023-02-07	539905752	32328267	-135626734	-112333386	414662865	151631181	97221834	32555297	325451817	84095796
2023-02-08	378114877	95113042	-213444522	-248795807	194903282	23558875	55879942	-46027787	127394956	-28812302
2023-02-09	355718047	154640562	-227566461	-328817169	-32267077	-57716325	-131418259	-88905209	38158509	-148499049
2023-02-10	113427906	-169671878	-626442470	-403706653	-264738883	-412715904	-270583235	-127289233	-19593753	-243982096
2023-02-13	137694581	-300646857	-328450996	-219314170	-205953218	-72326696	-216662034	24296122	15763387	-92158689
2023-02-14	163049029	2523224	-510928151	-252928444	-307176056	50325845	-314721863	140012221	-98477351	-27810667
2023-02-15	7896210	-83424048	-291603457	48078822	-282818215	-30078277	-122049154	228873275	-14501671	-100360103
2023-02-16	-211961749	-245996325	-162190813	57800794	-282427388	-280347513	-46661754	71399368	-126546124	-135454748
2023-02-17	-190742858	17364508	-232715654	64467576	-190697410	-221169180	-105725346	30206018	-77914970	-150049379
2023-02-21	-499228986	-89444740	-551818447	-190061000	-446990457	-604057782	-175710895	-95148654	-287836688	-315194328
2023-02-22	-599605368	-487484381	-536576069	-84774283	-576472903	-652172102	-127065573	-145079851	-385184507	-380926084
2023-02-23	-340296547	-647230662	-834459628	-287711697	-416833152	-897892757	-332517720	-229640367	-329362781	-301867329
2023-02-24	-291653064	-537288928	-1004888151	-274010809	-381381987	-903776638	-383050093	-209025852	-324577311	-287657327
2023-02-27	6031164	-497409937	-624886619	-280264835	-431372176	-564601360	-188426380	-26149347	-122371055	-148627373
2023-02-28	243325013	-446010089	-360893859	-78132680	-128446199	-303513764	-10732193	1403390	74353992	-19472069
2023-03-01	23184073	-477177010	-379437819	-208666343	83317690	-338568335	78275963	11433584	151654760	-86735857
2023-03-02	110962085	-388992108	-218255113	-174777464	120053258	-157738323	269412139	-102426823	83920726	-57529593
2023-03-03	347971891	-229329436	42803870	-36764489	444047578	191306342	465829484	64411946	422051378	49123800
2023-03-06	88605817	-468983512	-40037230	32786796	631920654	110367083	488372902	65243754	439709734	3072052
2023-03-07	-7776882	-448223344	-258181523	-24278143	344227205	-33661903	309166435	52195161	247600621	-7359456
2023-03-08	273910368	-500131344	-47875914	10102060	138505656	123578496	310782671	461205	415936087	126158325
2023-03-09	39051981	-715622744	-41774092	47915582	58504174	28988187	230009759	72697468	425172009	143715186
2023-03-10	-204305070	-823496231	-217080930	-71095490	-109161455	-276182897	59907035	-134880828	44956046	126640278
2023-03-13	-193313021	-522115732	-270978458	-38689673	-376553669	-280005675	-38986428	-122804891	-960516	91550275
2023-03-14	23175164	-334267740	-101561553	8480234	-97182409	-156934765	106120814	-53156829	226828432	143487727
2023-03-15	-200250875	-220077033	-244433579	126306391	-16283693	-32307255	58580991	-95122350	-28279590	108029876
2023-03-16	159398975	170254030	-163837337	230543783	-62900921	323739951	163434522	-60988984	82239115	184531480
2023-03-17	525207851	140986285	-648640246	305704831	-205177223	343040812	179941980	-21478085	32856547	144957796
2023-03-20	716557464	91788351	-546309643	206794665	35489898	305321910	210755332	-156969629	103277609	99616977
2023-03-21	492105040	131275794	-490431190	252648354	-287385510	233498051	266835389	-120254035	-167243714	-52063087
2023-03-22	648292049	110927017	-404052165	111056100	-141258945	-119763299	295215344	-114697526	72819681	-48835294
2023-03-23	441447327	11915377	-441369202	1558550	107797793	-34531603	262423957	-12549302	114335349	-107048141
2023-03-24	12972450	82243768	149664523	-110511953	181495768	325958703	280265811	-702122	189155021	-157437721
2023-03-27	-244563554	-13629339	-153218297	-52436811	-64785799	261345008	124908120	29268986	-32314020	-131295872
2023-03-28	-421640857	-216423099	-406652053	-254157614	-76624682	215069706	-80891858	-22283965	22869356	-142819391
2023-03-29	-349332372	-187498611	-254057991	-35909256	-2155596	534056428	-239369160	87238290	51129323	-143291208
2023-03-30	-251656913	-81442183	-176559290	73130916	-37527705	449942068	-435828030	81440623	29842425	-129340486
2023-03-31	174213072	249303712	-45573944	241731388	185286215	371098576	-290715313	249652388	183767078	-100785518
2023-04-03	279226347	14423911	371981693	243466482	223133929	524754642	-262753197	205913434	228347470	-147557050
2023-04-04	312768164	-6254201	390877455	447878013	498004558	488785608	-80708835	303344867	240245822	-130415159
2023-04-05	-872055	-215891811	64689810	204534701	127662570	181380143	-65590662	160121147	4432254	-243655250
2023-04-06	-33710179	-329333485	63443248	142930809	65490050	-140152018	193806600	22926163	-212938171	-231317810
2023-04-10	22498466	-651852998	-164752646	-66233437	-279467227	-379672892	-26751778	-105712854	-227293412	-53273036
2023-04-11	-96358811	-372772064	-503020701	-121727931	-115521210	-397914253	-66977563	-167777153	-289276891	-54426894
2023-04-12	-175486154	-454894303	-295527461	-392235087	-98187949	-396549379	-180291828	-194029618	-228473656	-88021232
2023-04-13	169310674	-61939435	82407101	-180545690	303794039	-43525120	238928	-37048815	-38394671	11606254
2023-04-14	105162985	-111392242	-101637253	-319327223	175417496	-68126517	-73026345	-35506653	-33022983	-116418992
2023-04-17	-212592125	-249756406	-159427386	-283842628	144863489	-176781881	-75046911	37738185	11043054	-294018624
2023-04-18	78968565	-412792275	69151807	-324532211	-56959588	-261901457	-66367969	146683888	194424845	-161939775
2023-04-19	525337539	-208862158	157471306	-75825181	-321405508	-385623913	-28998853	23491913	215548059	237167
2023-04-20	271121521	-594340480	37237122	-107650913	-633437537	-374189744	-24403941	-96673939	108633671	39599285
2023-04-21	24049997	-518232533	-73364759	27570117	-634389698	-195220079	-112101811	23349941	109919566	2810656
2023-04-24	13828271	-449201779	79332901	35376883	-500598421	112900279	79744442	-92363974	92175589	-39069590
2023-04-25	-292722465	-270972702	-3651066	27394107	-555125508	-54399930	69420517	-168944196	-96522010	-162189650
2023-04-26	-281192959	-477993727	-296182230	-190358001	-221192159	205307402	44751127	-13964960	-210078295	-172050370
2023-04-27	-370741674	-116436878	-209088883	-248941322	116528397	84179905	54404155	41815250	-248941750	-173488591
2023-04-28	66645164	-77980800	78467112	-379625168	77703231	206233579	-43305135	-99162992	-106719077	-24595258
2023-05-01	311703439	-178603090	150867553	-442169328	128788128	-83642198	-142628632	-98129163	-79039371	151750359
2023-05-02	306878566	-323924220	-62688775	-215688953	129239459	-72097109	-180495435	-50951838	-182765039	237026155
2023-05-03	-64623194	-153457838	175889917	-19461693	-70530189	54660054	-71820984	-147161848	49631966	81481074
2023-05-04	-111454270	-331804855	-39536832	65366221	-391651525	58873774	-267235859	-54976261	-9086556	127199272
2023-05-05	-180744099	-206139315	56719923	246770968	-415273993	60292022	-73192838	42604889	63219399	185369708
2023-05-08	-252204014	-128946004	-46900335	365956675	-398391917	399060786	67236572	166952498	-118682650	234642167
2023-05-09	-241031119	-97314430	-19049832	398495714	-113521111	712878558	264623000	280206314	-24438501	296002319
2023-05-10	9782698	-140052502	-38655440	385165845	-89666982	628348969	304104750	367952305	-38362436	415755570
2023-05-11	-10862943	-8588592	-4971631	367663145	171379185	706550760	438839491	202441484	26212930	290032748
2023-05-12	-463957234	-371221525	-355849570	135236862	91778332	446214557	441703039	117468788	-69862756	106348679
2023-05-15	-413365275	-444286603	-425709068	165274336	306179309	166616971	247649700	108659723	82257346	26176528
2023-05-16	32052869	-270400485	-121771087	109106738	89824087	-144305059	310518492	20619534	274547656	88295651
2023-05-17	192790440	-4233758	-279505387	131617075	295898094	-100835428	217778530	-27037386	310799418	138197639
2023-05-18	604281590	-21606093	-62454756	209131499	266275154	60929935	282865505	157586622	520643814	263631412
2023-05-19	641144212	229449671	139275805	224229599	209209696	-39502335	143628750	111247110	630722596	252932268
2023-05-22	549998475	454810843	134667080	55309787	263420506	88725901	313298131	130491145	446104239	330471135
2023-05-23	91676364	264506193	-135175697	115030325	472987193	-8166206	38004644	134219078	579226730	287523189
2023-05-24	-313189514	-16181614	-121220534	118800219	330401231	88427966	-138837639	168871343	270204411	244264398
2023-05-25	-525142009	-156238259	-261593992	-169424986	423536683	-342595793	-184380026	-130521375	438046944	232734389
2023-05-26	-227285273	-88158264	-85405078	128886257	904889437	189406458	3076190	95365443	817657316	343488770
2023-05-30	-228722020	-275836590	50187371	241258185	820988196	419786136	-81753987	132436319	1318504161	90242160
2023-05-31	-274257080	-69637705	239609574	-39896948	772886474	726587682	191792254	288967052	1392746206	-98562907
2023-06-01	55793480	46836627	458661065	16200819	893827149	772208397	484308597	250816562	1007754324	-85481535
2023-06-02	-301266106	176095749	476201694	249127101	804555652	786390495	510135312	575680373	1103430073	-256493934
2023-06-05	-200285558	-47199663	192815053	186196312	761215998	776790888	506608037	575304041	340837438	-210277689
2023-06-06	-563821321	110832848	58892150	384147230	779158985	324675440	589040639	555385260	-370486363	2030224
2023-06-07	-479105635	-133896576	-41265043	420641471	553139082	538774668	458408873	293591326	-460041838	1497921
2023-06-08	-482342656	125281226	-93096696	376099333	466912300	506759085	325629631	304919960	225312117	38175438
2023-06-09	70595447	-116022521	-52604642	249731274	414015432	892551028	302777409	99464917	-50682908	213437223
2023-06-12	-278181854	24645446	224936851	263022750	457886349	600460509	255210584	-55380499	581927014	155103370
2023-06-13	98046750	52033822	366740124	34733560	304730412	1094682927	46411618	-124943611	652193398	-46090221
2023-06-14	609999186	-66972588	488115079	40461421	644248372	1079871253	-39467896	94643953	785854778	-37143234
2023-06-15	483457648	-429735642	520389705	-70110822	769119138	1096730306	-9315771	161947545	379860774	-164337220
2023-06-16	689615924	-10588252	840973038	72469486	1107571541	476738807	-27979888	113231646	57486401	-495364981
2023-06-20	1174186371	96162739	776120406	49809475	951837236	668964397	-215902915	62747443	-213362980	-583093808
2023-06-21	737911417	-490427547	619496313	53825081	630758933	171122486	-214829975	-44878514	-131917209	-531546355
2023-06-22	630208293	-77971102	784167568	304659334	629271970	-308013670	28662300	-66749910	-685921190	-555160505
2023-06-23	366111370	-252843181	778601114	362028280	430519311	-696917080	-118474531	-176026314	-709434431	-548604156
2023-06-26	-300294799	-780602220	199575077	94916101	-268814550	-475900656	-262021228	-106445082	-366009226	-413864281
2023-06-27	-452522412	-808165189	234266002	72883842	-93688108	-531594990	-82082135	87237650	-292588249	-264627269
2023-06-28	-38645172	-244417201	535258868	134267689	50072749	-77050896	107094162	323644473	-132757608	-128560326
2023-06-29	-543754660	-464210805	445479516	-146649791	-297870800	-82536950	-124870623	135873251	258471737	58503582
2023-06-30	-132516644	-117312531	349865841	-42932798	-76614914	330468280	112330903	220132644	719081857	157498105
2023-07-03	206284680	118766266	331247005	89398090	147238980	282684062	201696911	281841914	566121724	297735509
2023-07-05	305119135	128728869	19401359	188404882	174255803	8131017	279871990	69491619	245981599	153221216
2023-07-06	-82747244	-89110309	-102363223	14601553	67557032	-448799974	51973555	-157668465	82246906	108076555
2023-07-07	438291631	-142491693	-156443526	286132325	401253009	-148180090	215214553	-4196415	-9013507	160179013
2023-07-10	53999754	-382705285	-342661734	61795399	309333985	-264318738	-25314340	-223655823	86757719	114609917
2023-07-11	-7743527	-353664670	-431946627	203829615	621147625	-319767805	57114802	-169089633	6778729	-42525020
2023-07-12	55903070	-547108677	-86036832	160297433	556142547	12042680	19008845	-62332275	383214349	118680833
2023-07-13	808350107	-309337978	-128923671	391035070	1004625531	387323178	289217064	147021374	454467046	56073708
2023-07-14	449770631	-1291070	-317543768	433584263	667143070	135778680	352151269	81014391	446893665	-45823706
2023-07-17	693833213	209095920	1703168	442501916	604435336	231989123	357612655	269347688	424388424	-11780677
2023-07-18	936394810	311051667	70433887	217610180	336149198	903125810	161485422	258342893	232389141	-30701064
2023-07-19	435755644	142743361	-71854052	269130657	443166801	848890935	6326376	235535686	-213164246	-233136559
2023-07-20	-365186997	-480355911	-255307531	84111378	-7812742	277596166	-185406086	-9927139	-274418312	-311868782
2023-07-21	-373206006	-728355728	-372292764	-131535649	-90042829	22275944	-221547973	78843638	-72672039	-249027715
2023-07-24	-121903260	-712521716	-215875477	-243809883	-501298920	-535797271	-20339161	-54342397	-196835030	-294270195
2023-07-25	25180883	-980176336	122319884	-12274381	-226109715	-959470083	22360034	-53951014	230425648	-65969049
2023-07-26	-77895388	-852764779	213032235	-121314351	-734788797	-1335166335	-74024750	-141329976	242992922	-40562275
2023-07-27	366054941	-688630196	301138958	29720675	-810579170	-1039389983	33898189	-10027038	510849345	101855854
2023-07-28	782603701	-490578821	596339196	186165892	-129074844	-393526670	58914667	22409933	369498795	71934738
2023-07-31	245561105	-524878492	390791073	506270987	-142443058	131021890	-41407847	146008865	134823024	78003226
2023-08-01	-381335834	-508975666	-9644241	135690764	-245808692	226098656	-74104946	21873493	142277645	74796626
2023-08-02	-445548354	-548828379	-373907864	-101942101	-291055532	250612476	-75337599	46062494	101924795	39348945
2023-08-03	-178108580	-92577540	-219905473	-80159724	155197241	586314776	-16453168	-92078482	-105745819	92568002
2023-08-04	-383265554	-364122590	-656562618	-333914873	-123919290	490139780	-113857658	-79936724	-296960246	162755080
2023-08-07	115778083	-482040030	-956834237	-403507327	444210756	445542185	13344893	-184181947	-91513764	196829712
2023-08-08	99861432	-295692488	-717455356	-298776922	22599898	150887589	20869158	-271846276	-394174727	-21479995
2023-08-09	92471418	-257887208	-577964417	-286991524	-27986316	214542948	40585810	-219581397	-386787204	12135750
2023-08-10	-515650295	-361446819	-636416873	-460548997	-236065860	244528614	40730913	-54496770	-318726123	-89556589
2023-08-11	-984531668	-371703886	-377800790	-380912090	-599280429	-64744552	-52173657	-218445792	-423287952	-320596363
2023-08-14	-836782785	-248819169	-35677139	-320553385	-880307859	-68789764	-154551767	-234756953	-391107060	-220464153
2023-08-15	-410026555	-424753889	-159358560	-361664282	-846543834	-10146436	-190510082	-132101386	-383613097	-124300214
2023-08-16	-88876555	-472305283	-44110397	-357642319	-812675927	-19701331	-161225876	-121137252	-185022525	-129228252
2023-08-17	-104426947	-590530907	-321519196	-281320016	-982319924	-502285497	-160035518	-227495079	-142967743	-185068410
2023-08-18	124258632	-509063351	-205986157	-222958779	-1085767098	-290289252	-246350135	-203021874	-136116490	16109816
2023-08-21	-65708102	-383264629	-405515123	-333964520	-818351132	-440279931	-242023460	-77892707	-19672695	-29096963
2023-08-22	-702832842	-309136603	-194361840	-216961040	-755204341	-185335625	13024375	26402228	25204663	-144853105
2023-08-23	-333396733	-82458144	-82516337	13794297	-210150204	263286900	256301061	155800229	169725149	45951427
2023-08-24	-556177904	-93045299	-28480809	-80091423	-223150345	274301360	47537373	91802428	74556395	-31343115
2023-08-25	-612067145	75577882	58079520	-67197562	-98357775	426050610	101973653	199633158	143819918	-60604131
2023-08-28	-872272247	-180431449	243820767	-221732126	-103072200	435315777	170831738	57664010	-9624481	-167801157
2023-08-29	-11932719	302811898	364286597	-23977847	315258602	428617803	170395107	64723352	273188398	85461361
2023-08-30	-239556876	306023449	334892596	-40717794	-257408842	298911404	138415023	739590	152790992	67656600
2023-08-31	315275695	538102423	623212531	308725978	258219341	536914164	347927438	170870041	618410247	182117347
2023-09-01	102050732	87282887	612359958	190891193	620067727	556359082	336386518	149184988	199499048	258247045
2023-09-05	324681081	350166687	643285388	192695368	642835178	774282547	201774929	256333741	272661750	353982714
2023-09-06	-502604908	-166382700	234065607	-40775371	152537219	465430940	-37980651	146217750	-6826234	149396438
2023-09-07	-894637643	-334981107	-11735334	44365203	463026477	177236537	-112892141	128892634	-226653911	-45806498
2023-09-08	-1310468396	-510071969	-11860063	-57778858	326554773	98187736	-96455429	171427580	-626744076	15850242
2023-09-11	-1345721441	112186806	-206634945	138722319	496453214	-24266025	82042743	214347177	-157380819	-215616845
2023-09-12	-1576218491	-214523545	-560713059	220137941	-15427896	-405919832	11751292	133699720	-444029594	-231698022
2023-09-13	-813350478	-70099479	-464142608	421678571	468570520	-516336919	208713334	125219971	-263449050	-38876125
2023-09-14	-831092234	126098834	-128517570	432534475	742572442	-654075097	326269603	35532517	105963983	9577929
2023-09-15	-665883954	261964981	-828036120	355338629	408978852	-667283356	-33847916	-122208668	-120850625	-226533265
2023-09-18	-148655356	-146879232	-542669046	141844313	331424841	-877093517	35445190	-253302525	-133806149	-202042836
2023-09-19	-289144182	-27951336	-314544362	73317965	638061337	-710660234	7337916	-278662066	-104800926	-354087367
2023-09-20	-795459784	-59983307	-394787724	-143084597	352288809	-567761442	-230940010	-232218436	-314194883	-380187601
2023-09-21	-785682307	-344070755	-694011154	-446708914	-231141514	-241566290	-527782180	-261691249	-767322472	-417270207
2023-09-22	-348672562	-684346821	-8687350	-471596522	246831232	-275436124	-272584625	-152443150	-297443519	-174982610
2023-09-25	-142697665	-640794340	-98127599	-272259750	-66545257	-15353433	-360198263	-92588374	-188027008	-47321204
2023-09-26	252511358	-591283483	-349114239	-211997978	-397077226	-183965869	-346085673	-68826323	-217203753	-13795652
2023-09-27	384591741	-737560461	-290349046	-151371924	-307843529	-82051139	-74066039	-66649726	-137911709	-17110364
2023-09-28	943410715	-456591055	-130243094	75125	217134665	-257094820	144419695	35005413	290535730	193583317
2023-09-29	761611785	-258504335	-170035131	55995880	-22056880	-39327314	94361400	48286328	54442742	190286719
2023-10-02	820360036	-102952742	-169453991	92691847	312146714	-60540693	166681808	-28371974	-14800972	62571957
2023-10-03	233367068	-253989132	-118998667	-4568633	349094980	19335114	217626104	-43021582	-19900598	23218744
2023-10-04	593231857	162151859	104212433	138450073	571498514	24060850	208033729	4772555	98289145	47439754
2023-10-05	669754218	-9164676	54569422	-40697649	57699319	-27652471	15073002	-36512043	-52755799	-140509446
2023-10-06	965360076	202910892	159528708	619401	271574436	-22696240	165322377	-13470992	71952331	-73558124
2023-10-09	601414825	109009253	236569820	-42089194	340610883	-259967401	155649797	80094516	119388752	79404851
2023-10-10	1160441707	382938456	348921168	232230017	845039814	-339517531	314768217	196733561	358571886	283158478
2023-10-11	1120004789	24412388	258557588	218418212	890861482	-458399330	307809496	176239264	347994204	50576039
2023-10-12	744970457	62203005	287677205	420885169	1122391477	-412171615	283236052	164543949	750807600	210978140
2023-10-13	58787253	-236974736	-46570867	197112923	587986074	-725849691	65079744	48171909	550017398	8610275
2023-10-16	482501095	-127418460	-367274084	222514092	548864910	-453350099	76990653	55046027	674848071	35884481
2023-10-17	126174457	-191590513	-565101400	12259843	458653950	-497355560	-9012377	-48062760	316358610	-150543105
2023-10-18	-406399294	-322575287	-699110848	-165573040	-129608587	-563911755	-79343259	-125947799	346840726	-98741334
2023-10-19	-187283604	-698237442	-732705335	-154186027	-70414822	-103431127	100168759	-27860057	-222779874	-138027215
2023-10-20	-40318563	-571340980	-852536615	-204800386	25862811	120563949	55600650	-49521060	-238387422	-53058220
2023-10-23	-56949072	-634123151	-632009097	-217565603	21907125	122936025	3071270	-69130996	-315468114	-174760180
2023-10-24	-66550253	-716571479	-496769716	-154846959	-179221049	538872374	151856545	15984278	61282069	-149406647
2023-10-25	-58756871	-539343247	-559857850	-148877307	-208468138	737112993	-78668490	6775822	-229642719	-148027628
2023-10-26	-428590393	-247507044	-658339526	-131305363	-280455442	279669948	-73100262	-22518186	-263190217	-120661764
2023-10-27	-462725817	-201129716	-220241585	115935479	135360525	93580249	5883033	76760458	-27337214	-1984024
2023-10-30	-794053436	-463998466	-121022827	122243249	91561568	146155347	52650357	77706912	-123456999	-26865986
2023-10-31	-744478441	-332058513	15445714	315178872	-168474511	-152951536	-194330306	59008951	-267212280	87034686
2023-11-01	-269428289	-249910640	298998925	494338143	388469940	45717783	106939836	77858011	1898725	368404772
2023-11-02	190099879	-112000718	585978328	473302728	198487754	307418338	180683621	-17716628	368138857	272245219
2023-11-03	725762851	-144615873	569588512	558580021	270641959	621315679	391287475	9957731	403974982	292171431
2023-11-06	913368327	6701772	583487040	643733714	285538119	382336384	424967778	-93759029	307731886	254943324
2023-11-07	1307005719	10149694	731654658	618141215	831777395	509431519	639615137	3861116	462065125	288985072
2023-11-08	1388110121	-66882490	749450955	372151509	537615901	359453352	708841780	-11551269	492365027	126386156
2023-11-09	1183288010	-300049539	558104688	233740480	963084306	275448351	528674143	97749243	529457150	197225132
2023-11-10	1252487895	-225364702	569368188	259023316	982263702	318079926	521023214	83496332	708847302	206932361
2023-11-13	1285802359	83390433	171541089	33118931	982870630	233751807	443708233	101441098	643062429	202323139
2023-11-14	1190058391	55808715	168211473	-19953511	982312288	346193851	430988125	70700283	706754374	166186112
2023-11-15	536600535	105750807	235639086	18887060	785418663	531539313	384215138	132640023	622440663	26508793
2023-11-16	690678767	34374890	388500407	32506933	432688547	628413253	564160748	41610720	185923622	89314622
2023-11-17	125290529	3565898	43249593	77331533	60426939	293279596	236852768	13689837	13315600	38061664
2023-11-20	345250036	-88246170	505934042	245005093	121463160	582994685	327388046	140454962	328679472	173595360
2023-11-21	-115174025	-74246202	168175779	4722835	-368507604	487168475	313402291	56438969	-266712322	-22498628
2023-11-22	-23315344	-168738387	201830651	318837650	94829477	403875269	322660232	108371649	-557396593	183578423
2023-11-24	-351224622	74896488	-179794271	450623498	167950311	330651790	129281220	186372306	-242486274	100341815'''

# Split the data by lines and then by tabs
lines = data.split('\n')
headers = lines[0].split('\t')
columns = {header: [] for header in headers}

# Populate the dictionary with data
for line in lines[1:]:
    values = line.split('\t')
    for header, value in zip(headers, values):
        columns[header].append(value)

keys = [i for i in columns.keys()]

for i in keys:

    if i != "Date":

        # Start Date & End Date
        start_date = columns['Date'][0]
        end_date = columns['Date'][-1]

        # Grabbing OHLC Data from Polygon
        ticker = i.split(':')[1]
        data = requests.get(
            f"https://api.polygon.io/v2/aggs/ticker/{ticker}/range/1/day/{start_date}/{end_date}?adjusted=true&sort=asc&limit=50000&apiKey={api_key}")
        data = data.json()['results']

        fs = ''
        ohlc_html_list = []
        final_ohlc_html_list = []
        final_nci_html_list = []
        for a in data:

            html = "{time:'@replace_with_date',open:,high:,low:,close:},"
            html = html.replace('open:',f'open:{a["o"]}').replace('high:',f'high:{a["h"]}')
            html = html.replace('low:',f'low:{a["l"]}').replace('close:',f'close:{a["c"]}')
            ohlc_html_list.append(html)
        for date, ohlc_html in zip(columns['Date'], ohlc_html_list):

            ohlc_html = ohlc_html.replace("@replace_with_date", date)
            final_ohlc_html_list.append(ohlc_html)

        for date, nci in zip(columns['Date'], columns[i]):

            nci_html = "{time:'@replace_with_date',value:@replace_with_nci},".replace("@replace_with_date", date).replace("@replace_with_nci", nci)
            final_nci_html_list.append(nci_html)

        final_ohlc_html_str = ""
        final_nci_html_str = ""

        for ohlc, nci in zip(final_ohlc_html_list, final_nci_html_list):

            final_ohlc_html_str = f"{final_ohlc_html_str}{ohlc}\n"
            final_nci_html_str = f"{final_nci_html_str}{nci}\n"

        html_template = """
<!doctype html>
<html lang="en">
   <head>
           <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LYVSDS633M"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'G-LYVSDS633M');
      </script>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>@replace_ticker Capital Trend</title>
      <link rel="icon" type="image/x-icon" href="../../favicon_1.png">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
      <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
      <link rel="stylesheet" href="../../chart-styles.css">
   </head>
   <body>
      <section>
         <img id="site-logo" src="../../regentquant-logo-two-colors.svg">
         <h1 class="chart-title">Regentquant @replace_ticker Capital Trend (Capital Trend Shown as 5D Average Value)</h1>
         <h2 class="go-back-to-home-screen"><a href="https://www.regentquant.com">Go Back To Home Screen</a></h2>
         <h2>How to use: Investors can predict future price trend by looking at capital trend. Candlestick chart shows underlying stock's historical adjusted OHLC price. Line chart shows daily block order amount (Unit$). Here block order stands for the largest 30% of orders in terms of turnover over the past 200 days. The data is estimated by algorithm and for reference only.</h2>
        <button id="download-chart">Save Chart</button>
      </section>
      <!-- Fund NAV Chart -->
      <div id="container"></div>
      <section id="footer"></section>
      <script type="text/javascript">
        // Lightweight Charts™ Example: Two Price Scales
// https://tradingview.github.io/lightweight-charts/tutorials/how_to/two-price-scales

const chartOptions = {
	rightPriceScale: {
		visible: true,
	},
	leftPriceScale: {
		visible: true,
	},
	layout: {
		textColor: 'black',
		background: { type: 'solid', color: 'white' },
	},
	crosshair: {
		mode: 0, // CrosshairMode.Normal
	},
};
/** @type {import('lightweight-charts').IChartApi} */
const chart = LightweightCharts.createChart(document.getElementById('container'), chartOptions);
const baselineSeries = chart.addBaselineSeries({ baseValue: { type: 'price', price: 0 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba(38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 207, 87, 119, 1)', bottomFillColor1: 'rgba(207, 87, 119, 0.05)', bottomFillColor2: 'rgba( 207, 87, 119, 0.28)' });
const data = [
@replace_nci
];
baselineSeries.setData(data);


const candlestickSeries = chart.addCandlestickSeries({
	priceScaleId: 'left',
	upColor: '#26a69a', downColor: '#e04d76', borderVisible: false,
	wickUpColor: '#26a69a', wickDownColor: '#e04d76',
});

candlestickSeries.setData([
@replace_ohlc
]);

chart.timeScale().fitContent();

         chart.applyOptions({
                         layout: {
                             fontFamily: "'Saira Condensed', sans-serif",
                         },
                     });

         window.addEventListener('resize', resizeChart);

         function resizeChart() {
         const container = document.getElementById('container');
         chart.resize(
         container.offsetWidth,
         container.offsetHeight
         );
         }
         resizeChart();
         document.getElementById('download-chart').addEventListener('click', function() {
         const chartContainer = document.getElementById('container');

         html2canvas(chartContainer, {
         scale: 5  // Increase this value for higher resolution
         }).then(canvas => {
         const link = document.createElement('a');
         link.href = canvas.toDataURL('image/png');
         link.download = 'chart_high_res.png';
         link.click();
         });
         });

      </script>
   </body>
</html>
"""

        formatted_html = html_template.replace("@replace_ticker", ticker).replace("@replace_nci", final_nci_html_str).replace("@replace_ohlc", final_ohlc_html_str)


        # Check if html exists
        asset_type = i.split(':')[0]
        file_name = f"capital-trend-{ticker.lower()}.html"

        if asset_type == "ETF":
            # Check if the file exists
            if not os.path.exists(f"ETF/{file_name}"):
                # Create the file if it doesn't exist
                with open(f"ETF/{file_name}", 'w') as file:
                    file.write('')  # Creating an empty file
                file.close()

            with open(f"ETF/{file_name}", "w") as file:
                file.write(formatted_html)
            file.close()

        elif asset_type == "STOCK":
            # Check if the file exists
            if not os.path.exists(f"STOCK/{file_name}"):
                # Create the file if it doesn't exist
                with open(f"STOCK/{file_name}", 'w') as file:
                    file.write('')  # Creating an empty file
                file.close()
            with open(f"STOCK/{file_name}", "w") as file:
                file.write(formatted_html)
            file.close()
        print(file_name)
