import pyperclip
import requests
import pyperclip
import os
def capital_trend():

    ticker = ""

    input = pyperclip.paste().split('\n')

    a_string = ''
    b_string = ''

    for i in input:
        if "{" not in i:
            ticker = i.strip()
        else:
            list = i.split('\t')
            a_string = f"{a_string}{list[0]}\n"
            b_string = f"{b_string}{list[1]}\n"

    html_content = """
<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LYVSDS633M"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LYVSDS633M');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>@replace_with_ticker Capital Trend</title>
<link rel="icon" type="image/x-icon" href="favicon_1.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="chart-styles.css">
</head>
<body>
<section>
<img id="site-logo" src="regentquant-logo-two-colors.svg">
<h1 class="chart-title">Regentquant @replace_with_ticker Capital Trend</h1>
<h2 class="go-back-to-home-screen"><a href="https://www.regentquant.com">Go Back To Home Screen</a></h2>
<h2>How to use: Investors can predict future price trend by looking at capital trend. Candlestick chart shows underlying stock's historical adjusted OHLC price. Line chart shows daily block order amount (Unit$). Here block order stands for the largest 30% of orders in terms of turnover over the past 200 days. The data is estimated by algorithm and for reference only.</h2>
<button id="download-chart">Save Chart</button>
</section>
<!-- Fund NAV Chart -->
<div id="container"></div>
<section id="footer"></section>
<script type="text/javascript">
// Lightweight Chartsâ„¢ Example: Two Price Scales
// https://tradingview.github.io/lightweight-charts/tutorials/how_to/two-price-scales
const chartOptions = {
rightPriceScale: {
visible: true,
},
leftPriceScale: {
visible: true,
},
layout: {
textColor: 'black',
background: { type: 'solid', color: 'white' },
},
crosshair: {
mode: 0, // CrosshairMode.Normal
},
};
/** @type {import('lightweight-charts').IChartApi} */
const chart = LightweightCharts.createChart(document.getElementById('container'), chartOptions);
const baselineSeries = chart.addBaselineSeries({ baseValue: { type: 'price', price: 0 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba( 38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 239, 83, 80, 1)', bottomFillColor1: 'rgba( 239, 83, 80, 0.05)', bottomFillColor2: 'rgba( 239, 83, 80, 0.28)' });
const data = [@REPLACE_A];
baselineSeries.setData(data);
const candlestickSeries = chart.addCandlestickSeries({
priceScaleId: 'left',
upColor: '#26a69a', downColor: '#ef5350', borderVisible: false,
wickUpColor: '#26a69a', wickDownColor: '#ef5350',
});
candlestickSeries.setData([@REPLACE_B]);
chart.timeScale().fitContent();
chart.applyOptions({
layout: {
fontFamily: "'Saira Condensed', sans-serif",
},
});
window.addEventListener('resize', resizeChart);
function resizeChart() {
const container = document.getElementById('container');
chart.resize(
container.offsetWidth,
container.offsetHeight
);
}
resizeChart();
document.getElementById('download-chart').addEventListener('click', function() {
const chartContainer = document.getElementById('container');
html2canvas(chartContainer, {
scale: 5  // Increase this value for higher resolution
}).then(canvas => {
const link = document.createElement('a');
link.href = canvas.toDataURL('image/png');
link.download = 'chart_high_res.png';
link.click();
});
});
</script>
</body>
</html>
""".replace("@REPLACE_A",a_string).replace("@REPLACE_B",b_string).replace("@replace_with_ticker", ticker.upper())
    file_path = f'capital-trend-{ticker}.html'

    # Writing the HTML content to the file
    with open(file_path, 'w') as file:
        file.write(html_content)

    file.close()
    print(ticker)

api_key = "ezBrk47F0tOiUtSZU7KevlNnxEEwPgIs"
data = '''Date	STOCK:NVDA	STOCK:TSLA	STOCK:AAPL	STOCK:AMZN	ETF:SOXL	STOCK:META
2023-01-03	-668161643	-980038545	-964315494	-15483292	-193104263	414200861
2023-01-04	492493781	431357097	-124819853	-348261784	171773230	669263149
2023-01-05	-573849601	-34424919	-554584053	-444894587	-168002619	-213744234
2023-01-06	512685344	714991499	260877138	277962742	183529215	475242508
2023-01-09	291519546	-58175545	350157557	482730334	124096391	538405476
2023-01-10	473487990	-282819600	-156189632	390639641	92826280	545580508
2023-01-11	-466205624	-159694570	170803469	599691218	32336476	-143992714
2023-01-12	343317912	-184961633	-335895466	-360329319	46231334	480685170
2023-01-13	404968116	230633831	50902207	298445417	-121775460	567460573
2023-01-17	766056065	406774612	286457549	-834716288	187058560	-713090759
2023-01-18	-429786078	-1181105768	-399598729	-89778075	-76380832	-464161007
2023-01-19	-706762617	-508544414	-93984520	-407868149	-249072175	689407488
2023-01-20	1142389054	377881739	-243728486	106448826	212183389	679793441
2023-01-23	919243994	640559017	233459270	-70122144	308379293	641931157
2023-01-24	83742220	-172974450	640114426	-217268118	-184965227	216410123
2023-01-25	-125547086	-53816986	-361680767	153993064	45574317	-743430192
2023-01-26	403245694	-397578864	-49490766	252399313	-16178038	558665263
2023-01-27	672766888	1835298383	573836750	477481355	153209437	652667235
2023-01-30	-565068835	-1754893910	-621794958	-348128371	-235165872	-864950928
2023-01-31	442049154	468904732	340785057	595695181	258981277	223567424
2023-02-01	608374179	98714198	-297538650	-161229947	254951649	270960057
2023-02-02	382172416	-385642752	-710480234	58707725	162416960	317021062
2023-02-03	252520523	294303510	1026593940	-3575690	26178878	590687780
2023-02-06	639477319	121288565	-812220190	-297461819	-133698789	395524751
2023-02-07	816984323	32977814	115511462	-158107197	186641642	499120677
2023-02-08	-200580198	412638074	-686627589	-843542056	-210465627	-827837861
2023-02-09	270188266	-88005152	-781089930	-341399083	32025586	-818830733
2023-02-10	-958930179	-1327258689	-967786105	-378023112	-235433682	-571671250
2023-02-13	760810692	-533586333	677737181	624500598	200050584	689453078
2023-02-14	943756566	1548828221	-796874314	-326178568	140464584	-6993516
2023-02-15	-976344295	-17098286	409995885	661494273	124462079	-706048653
2023-02-16	-829101528	-900866536	-134026710	-292789221	-206194885	-816876600
2023-02-17	-852835726	-10454528	-1320410312	-344689201	-235450654	-113021361
2023-02-21	-781619948	-1067632573	-917776786	-648142284	-209471657	-592012157
2023-02-22	441874657	-441369982	-720662424	200255016	-49380038	-654405743
2023-02-23	320199809	-815829692	-1079421908	-353192796	21258397	92150100
2023-02-24	-585884113	-351157866	-986169326	-224284778	-178318275	-639620776
2023-02-27	635585415	188940426	579597349	-375959331	167069946	-362972304
2023-02-28	404849295	-810633330	402187016	362518488	183576212	922617729
2023-03-01	-658830040	-597204589	-813382227	-452413296	92213319	404413702
2023-03-02	759089870	-374905180	-273508379	-183748405	-25771367	275827937
2023-03-03	599164917	447155494	319125589	465780100	104488936	980350828
2023-03-06	-661244959	-1009329957	165391849	-28202908	-41259614	576393073
2023-03-07	-77064198	-706832489	-688534445	77193796	-213888857	-515849517
2023-03-08	749606212	-856744587	238145818	-280512282	246259722	-624194040
2023-03-09	-415202069	-1452362183	-242999270	5319202	22268020	-124179476
2023-03-10	-617620334	-92211939	-557408603	-129275256	-168581741	142022685
2023-03-13	-606284715	497572538	-104095792	133826176	-126244918	-760567996
2023-03-14	1005376724	232407473	158550084	313043331	210157022	881006780
2023-03-15	-367523979	-285791056	-476214316	308618502	-207191102	-219700457
2023-03-16	1383047177	499293133	159981940	526506160	287217348	-357265615
2023-03-17	1211424047	-238550662	-2981423144	246529985	-178009297	-569358829
2023-03-20	350463350	251582865	407557219	-360724653	170116380	442767611
2023-03-21	-116885396	429844692	437942349	542311776	-70962262	-733370258
2023-03-22	413411068	-387534941	-44319188	-399342769	169230392	510932364
2023-03-23	348823565	4234929	-26603244	-20981588	204878589	888018075
2023-03-24	-930950335	113091295	-26254521	-313822530	-212907016	-200868954
2023-03-27	-937216670	-227782671	-1106856880	-70348943	-152077974	-788640224
2023-03-28	-1002271915	-584124106	-829226431	-466292240	-241760425	-792564671
2023-03-29	774953493	-242912504	718651121	691899022	256224295	883277795
2023-03-30	837200860	534517071	360890263	524219270	233564031	711157530
2023-03-31	1198399590	1766820769	628672208	529179830	212990204	913200643
2023-04-03	-412150292	-1402181673	980921303	-61673471	-209883871	-599401650
2023-04-04	-834562831	-687514667	-734747619	555765413	-240614725	581788474
2023-04-05	-793247601	-1291100553	-912287105	-524817537	-241942828	-968432148
2023-04-06	673010240	-32691303	354657451	216199811	88975645	400294930
2023-04-10	1479442813	154223208	-512307259	-516641402	197050617	-811585740
2023-04-11	-1006436677	-6777007	-710418974	-339145941	-135562070	220328434
2023-04-12	-1230199544	-1098125862	302718582	-796770365	-222023323	668454779
2023-04-13	930736539	673673790	977385707	533629447	193306175	1041477791
2023-04-14	352271796	-279955337	-565564319	-477707852	-183923272	-241587784
2023-04-17	-109332740	-537597614	-801257926	-339218428	-215090801	-964355777
2023-04-18	451366776	-821956354	432476993	-542593856	119819821	-788786950
2023-04-19	1001645323	-78475274	744316076	446764786	-233051967	-653774822
2023-04-20	-340343551	-1253717821	376214784	374500787	166897223	-518682354
2023-04-21	-883085825	100584399	-1118573724	198397294	-196152458	-246348589
2023-04-24	-160441370	-192443846	-37769622	-300184594	-133275873	-295399388
2023-04-25	-1081386901	69189033	17557155	-582507739	-258144861	-1061422386
2023-04-26	1059292854	-1113580400	-718339742	-641995753	-69255125	1015891922
2023-04-27	-788087127	554066425	811681519	81584184	-183038325	1169920425
2023-04-28	1303848364	292864787	319206252	-455021939	158678395	-440474417
2023-05-01	1064850004	-695555296	324232580	-612905392	191183230	-39974902
2023-05-02	-1105511266	-657416615	-1050224484	549894137	-197589705	-1059165734
2023-05-03	-798215946	-261248489	474553716	339140546	11407	17043682
2023-05-04	-1022242505	-337668660	-265452223	505723755	-170427775	-435686252
2023-05-05	957399217	921192483	800490028	452001792	172538003	-558586761
2023-05-08	707550431	-309588737	-193868712	-16976855	60914478	44435481
2023-05-09	-1049646794	-499258746	-910971969	712589333	-227012728	365188297
2023-05-10	455853140	-474938852	376525676	272491201	173299014	136314324
2023-05-11	-1125470708	319650893	-97033179	418210255	-187060752	869544583
2023-05-12	-1308072239	-891972181	-953899668	-710129624	-176576878	-956591025
2023-05-15	960510228	-674914128	-543166201	133210515	221840120	1116440366
2023-05-16	1177443925	370171842	608717935	431751345	175180704	-716587814
2023-05-17	1259540995	855894785	-412145820	385042885	249964113	1166684360
2023-05-18	931985039	232789216	988219972	805782376	268503909	721429883
2023-05-19	-1123759126	363306640	54753138	-634639124	-202156647	-1241918313
2023-05-22	504781543	451891731	-566209823	-711388545	187120558	1387494412
2023-05-23	-1114166633	-581351408	-740495953	730354035	-219058061	331245623
2023-05-24	-764788391	-547544250	-342370004	403892351	-220745545	453754550
2023-05-25	-127777439	-467494007	286352683	-635343648	350399036	1187107141
2023-05-26	365524557	703706612	935697706	856917092	310540980	1164845458
2023-05-30	497597808	-486499898	111752423	-149528903	-153366709	967988210
2023-05-31	-1341841936	449643019	206615061	-675421632	-279363635	90737011
2023-06-01	885464410	34827410	752887452	684381185	255620848	1058457926
2023-06-02	-1913075371	178801601	374055827	529287764	-287151002	740749653
2023-06-05	870427298	-412770446	-481235499	542263146	-241955767	948147192
2023-06-06	-1320081007	303662658	-557862091	840225688	226429283	1057703141
2023-06-07	-918263504	-774004101	-294170902	-492950429	65402586	-1039362503
2023-06-08	869279302	1330716416	493729184	461670494	223812404	627324015
2023-06-09	851615146	-1027717132	576516100	-102552531	143210605	476265314
2023-06-12	-873459209	290569388	906471963	608720527	309839977	1167501776
2023-06-13	561062013	440604540	151154273	-301220262	96761986	291923457
2023-06-14	1641498680	-1369036150	312703876	-464311125	47570662	658227298
2023-06-15	236571609	-483098854	655102312	-91190721	-253898154	1251677845
2023-06-16	1882406525	1068019814	2179432765	610349009	-317601472	2168527331
2023-06-20	1549393030	824324343	582208804	495420476	-230902054	388830247
2023-06-21	-1620312760	-2492346886	-631966192	-281142234	-294122326	-1313468055
2023-06-22	1102983063	693246072	1136060153	789860140	219035836	650792483
2023-06-23	-1083913008	-1357459247	627270038	195654010	-219810250	257914547
2023-06-26	-1449624321	-1570775380	-715697416	-725211885	176841693	-1328141970
2023-06-27	788254965	686509496	755663429	385259180	276202482	1264462454
2023-06-28	449073441	326393055	872998135	25777002	140512330	-594663767
2023-06-29	-1422564379	-405721948	687163392	-614727264	-263761230	-1088925266
2023-06-30	972277075	377032123	149201667	714238977	300611865	1364193980
2023-07-03	244382296	-390381394	-808791596	-63557447	75752345	-208872499
2023-07-05	1282427241	736322510	-803564801	880293143	-269230769	1399546569
2023-07-06	-1490258451	-762802837	264175223	-843239643	-276978710	-1128157625
2023-07-07	1182629993	-672628869	416761875	742926593	179182312	579554620
2023-07-10	-949182311	-824035833	-781889373	-407445650	259094663	904598862
2023-07-11	-64334109	-245178323	-1255216058	646613630	-268830383	1350195697
2023-07-12	1600660226	-230897523	925984172	662632237	239648632	1074521182
2023-07-13	2271976734	426050658	49741027	310448539	261556173	1114257293
2023-07-14	-610267387	867605672	-526338609	955672561	-160494530	-1107857682
2023-07-17	271130600	227899116	814345310	-362857386	310435876	591060191
2023-07-18	1148473876	264600411	-911562464	-477845049	-135952830	8765005
2023-07-19	-902535603	-1072439052	214544475	920234622	-309315126	1609609198
2023-07-20	-1732736473	-2689445701	-867526366	-614647857	-319372298	-1140640424
2023-07-21	-650362432	-372393412	-1111264774	-122562573	231887129	-1519008116
2023-07-24	1527644331	307069175	1596431744	-924228557	-82292480	-1465220264
2023-07-25	1883894590	-1073672692	779414342	679832461	287651010	1384711033
2023-07-26	-1417916955	-435381266	668106227	375034772	-256232068	-933786212
2023-07-27	487015172	-1868772783	-426992748	140527274	217355471	-1519592293
2023-07-28	1432381369	617863459	364736417	659663512	237273091	1888513514
2023-07-31	-1157568649	135570823	568691125	676296914	185953559	-1532061330
2023-08-01	-1250590106	-994158565	-1222762226	-1173068650	83666141	867882860
2023-08-02	-1738979556	-634644830	-1153211887	-813129554	-355994623	-1160020411
2023-08-03	1824214040	412481415	343019208	249439156	134171322	711671572
2023-08-04	406596500	-739861795	-1818549310	-609112233	-83739353	492930859
2023-08-07	1337649536	-454016373	-932666972	328334646	-134129926	1308588899
2023-08-08	-1330173360	-62420857	-25867820	-649416624	-273222982	-1240171431
2023-08-09	-1775929626	-445618431	-455757189	-754202564	-279744005	-1412951481
2023-08-10	-1216394523	-105316638	50756924	-618348212	-181127193	-328726144
2023-08-11	-1937810367	-791147131	-525468892	-210927694	-216027661	-1323141986
2023-08-14	2076393953	160407210	777951283	630128167	213955894	-96548253
2023-08-15	803607789	-942094454	-644274926	-854971107	-214542640	-1071351304
2023-08-16	-170179628	-683375402	120483628	-734092749	-267770421	-1243611946
2023-08-17	-1294146481	-696444760	-1336287072	-236736696	-129122273	-1176946132
2023-08-18	-794382472	-383809349	52196301	80878491	5303592	-1840377854
2023-08-21	1126560283	789400821	-219693548	75099461	256091359	1240531577
2023-08-22	-2382015913	-571454327	411491491	-269953709	-275295010	-755617351
2023-08-23	1677000916	450016896	679711141	419683939	249601014	1481658739
2023-08-24	-2408052336	-749380535	-1066109428	-706165296	-257968164	-1241946836
2023-08-25	-1073828676	459306555	484997942	145347793	-39647822	-1216415002
2023-08-28	-174465228	-490645834	709012690	-697573356	185525910	1216959452
2023-08-29	1919681728	1844762409	1013820640	718817683	274860035	1336036659
2023-08-30	538880134	466074652	532741137	335984205	225344416	-1381678485
2023-08-31	366110517	411014332	375490247	1041053567	247757562	1336194082
2023-09-01	-2139953493	-1794791125	430735076	-443826134	178054363	592826925
2023-09-05	938686517	823773167	863639838	-688552483	199112458	1330796707
2023-09-06	-2216748217	-737984527	-1032278263	-448536008	-245246621	-1115453136
2023-09-07	-1421283540	-376917380	-696263567	761687075	-240530173	170767808
2023-09-08	-1713043248	-464439980	374866601	530333258	-206342218	653835562
2023-09-11	-2316218718	1316502749	-543139333	538679752	-271661150	1442319131
2023-09-12	-213798731	-809778587	-906750734	-281474372	-7045583	-1228608845
2023-09-13	1597591849	-15864198	-549426007	559167141	210116034	1304538945
2023-09-14	-1509992322	604074186	981861621	815966596	-27074226	1540777418
2023-09-15	-887001847	214890755	-3122726147	144354030	-355681948	-1014132391
2023-09-18	269924269	-727718318	883696039	-528791828	58768602	1054549077
2023-09-19	-916242858	-215139103	233872686	-624106115	-249236885	304573634
2023-09-20	-933986161	-176024055	-950642820	-522845667	-10601529	-124323694
2023-09-21	-1461104937	-816363052	-514255527	-702154991	-252250182	-1376374198
2023-09-22	1298046878	-1486489576	303892870	19915992	212871615	1375731343
2023-09-25	1299798753	-509955915	436494794	467892031	-8996338	-512333371
2023-09-26	1059802259	32415183	-1021060510	-322797256	-258885345	-1348086209
2023-09-27	-273584249	-907408945	-656816856	-219715394	-93073749	321844790
2023-09-28	1332989932	588483977	286274230	55080250	156665387	1248516771
2023-09-29	389052228	-496055975	104932688	299519771	-116867481	179773621
2023-10-02	1593540009	267802050	439400492	651371864	-215938988	1158684598
2023-10-03	-1875162582	-722766769	-768783890	-809099656	-219588145	-1163344878
2023-10-04	1525739696	1173296014	459238646	495378138	192043476	1433862456
2023-10-05	1715601738	-268098700	38059176	-840658360	-238635927	-1320479201
2023-10-06	1867081521	564321867	629729115	506105018	208906954	1249149205
2023-10-09	-226186246	-201706147	824606051	437828889	-70161693	1503866832
2023-10-10	919971825	646879245	-207027149	562496398	233556714	1358799777
2023-10-11	1323555109	-619334326	7420745	426319116	28914323	1662970799
2023-10-12	-159569925	-79145614	183657265	171676425	53752438	-162829227
2023-10-13	-1563834496	-931566839	-1041511246	-612756214	-301314420	-1422877809
2023-10-16	1892382963	346075236	-778910033	564834734	251712455	1308261008
2023-10-17	-861661366	326018977	-1196163731	-488774844	-259701841	907744978
2023-10-18	-1339313645	-1274258194	-662626493	-462845303	-232042278	-1278341885
2023-10-19	936008524	-1957456391	15684828	228611490	-79163768	133139597
2023-10-20	-829009289	-297084527	-1640667644	-865828006	-204080811	-941489643
2023-10-23	1809230418	32164381	323727556	501008647	112453760	1288482580
2023-10-24	-909667271	-86222665	-519966827	-175181622	-9033677	-97895894
2023-10-25	-1300346737	-388117032	-978067164	-432997045	-231067786	-1424577328
2023-10-26	-913159085	-498275378	-476723550	316471210	158093254	-226796926
2023-10-27	-999686409	-65197885	549822058	370376203	-56147850	1137590191
2023-10-30	152592324	-1282179368	819821350	532547500	-214243370	1069487797
2023-10-31	-661792299	573477099	162375874	789496490	162880798	-1398076287
2023-11-01	1074904023	22622332	439698893	462799313	214686354	1360144926
2023-11-02	1384481758	191274234	958173467	211294134	262397811	-1176707855
2023-11-03	1678628451	-228273660	467872975	796762667	298357242	1498361212
2023-11-06	1090619700	-525591144	889313989	958315965	-239106767	1143968599
2023-11-07	1306394664	590716707	903213968	661533998	233382507	1333120093
2023-11-08	1480426034	-362538587	528680375	-767149217	84927693	-110662542
2023-11-09	360371199	-974561011	1442133	-480761014	127651247	950634168
2023-11-10	2024627880	145150523	524190477	923176850	333439311	1594258192
2023-11-13	1257192019	1018184533	-1099821510	-171205960	-287641275	1147003241
2023-11-14	827674821	452808115	886565891	396171786	435212042	1330328379
2023-11-15	-1786863242	-112828123	865818438	-572946364	39712422	-1095130666
2023-11-16	1130762358	-1331440598	765748740	-412661648	69392952	-813016412
2023-11-17	-802313313	-8894437	-1202063596	1147299849	326005540	-267049849
2023-11-20	2356989558	559124193	1213600735	667161843	350130716	1452184349
2023-11-21	-1474445485	522807954	-802225424	-805239507	-359770423	-1119525443
2023-11-22	-1327569840	-585289048	1034092802	997627711	233469795	1221554742
2023-11-24	-508784032	-113266221	-1142375872	246267593	122383951	-447412244'''


# Split the data by lines and then by tabs
lines = data.split('\n')
headers = lines[0].split('\t')
columns = {header: [] for header in headers}

# Populate the dictionary with data
for line in lines[1:]:
    values = line.split('\t')
    for header, value in zip(headers, values):
        columns[header].append(value)

keys = [i for i in columns.keys()]

for i in keys:

    if i != "Date":

        # Start Date & End Date
        start_date = columns['Date'][0]
        end_date = columns['Date'][-1]

        # Grabbing OHLC Data from Polygon
        ticker = i.split(':')[1]
        data = requests.get(
            f"https://api.polygon.io/v2/aggs/ticker/{ticker}/range/1/day/{start_date}/{end_date}?adjusted=true&sort=asc&limit=50000&apiKey={api_key}")
        data = data.json()['results']

        fs = ''
        ohlc_html_list = []
        final_ohlc_html_list = []
        final_nci_html_list = []
        for a in data:

            html = "{time:'@replace_with_date',open:,high:,low:,close:},"
            html = html.replace('open:',f'open:{a["o"]}').replace('high:',f'high:{a["h"]}')
            html = html.replace('low:',f'low:{a["l"]}').replace('close:',f'close:{a["c"]}')
            ohlc_html_list.append(html)
        for date, ohlc_html in zip(columns['Date'], ohlc_html_list):

            ohlc_html = ohlc_html.replace("@replace_with_date", date)
            final_ohlc_html_list.append(ohlc_html)

        for date, nci in zip(columns['Date'], columns[i]):

            nci_html = "{time:'@replace_with_date',value:@replace_with_nci},".replace("@replace_with_date", date).replace("@replace_with_nci", nci)
            final_nci_html_list.append(nci_html)

        final_ohlc_html_str = ""
        final_nci_html_str = ""

        for ohlc, nci in zip(final_ohlc_html_list, final_nci_html_list):

            final_ohlc_html_str = f"{final_ohlc_html_str}{ohlc}\n"
            final_nci_html_str = f"{final_nci_html_str}{nci}\n"

        html_template = """
<!doctype html>
<html lang="en">
   <head>
           <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LYVSDS633M"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'G-LYVSDS633M');
      </script>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>@replace_ticker Capital Trend</title>
      <link rel="icon" type="image/x-icon" href="../../favicon_1.png">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
      <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
      <link rel="stylesheet" href="../../chart-styles.css">
   </head>
   <body>
      <section>
         <img id="site-logo" src="../../regentquant-logo-two-colors.svg">
         <h1 class="chart-title">Regentquant @replace_ticker Capital Trend</h1>
         <h2 class="go-back-to-home-screen"><a href="https://www.regentquant.com">Go Back To Home Screen</a></h2>
         <h2>How to use: Investors can predict future price trend by looking at capital trend. Candlestick chart shows underlying stock's historical adjusted OHLC price. Line chart shows daily block order amount (Unit$). Here block order stands for the largest 30% of orders in terms of turnover over the past 200 days. The data is estimated by algorithm and for reference only.</h2>
        <button id="download-chart">Save Chart</button>
      </section>
      <!-- Fund NAV Chart -->
      <div id="container"></div>
      <section id="footer"></section>
      <script type="text/javascript">
        // Lightweight Chartsâ„¢ Example: Two Price Scales
// https://tradingview.github.io/lightweight-charts/tutorials/how_to/two-price-scales

const chartOptions = {
	rightPriceScale: {
		visible: true,
	},
	leftPriceScale: {
		visible: true,
	},
	layout: {
		textColor: 'black',
		background: { type: 'solid', color: 'white' },
	},
	crosshair: {
		mode: 0, // CrosshairMode.Normal
	},
};
/** @type {import('lightweight-charts').IChartApi} */
const chart = LightweightCharts.createChart(document.getElementById('container'), chartOptions);
const baselineSeries = chart.addBaselineSeries({ baseValue: { type: 'price', price: 0 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba( 38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 239, 83, 80, 1)', bottomFillColor1: 'rgba( 239, 83, 80, 0.05)', bottomFillColor2: 'rgba( 239, 83, 80, 0.28)' });
const data = [
@replace_nci
];
baselineSeries.setData(data);


const candlestickSeries = chart.addCandlestickSeries({
	priceScaleId: 'left',
	upColor: '#26a69a', downColor: '#ef5350', borderVisible: false,
	wickUpColor: '#26a69a', wickDownColor: '#ef5350',
});

candlestickSeries.setData([
@replace_ohlc
]);

chart.timeScale().fitContent();

         chart.applyOptions({
                         layout: {
                             fontFamily: "'Saira Condensed', sans-serif",
                         },
                     });

         window.addEventListener('resize', resizeChart);

         function resizeChart() {
         const container = document.getElementById('container');
         chart.resize(
         container.offsetWidth,
         container.offsetHeight
         );
         }
         resizeChart();
         document.getElementById('download-chart').addEventListener('click', function() {
         const chartContainer = document.getElementById('container');

         html2canvas(chartContainer, {
         scale: 5  // Increase this value for higher resolution
         }).then(canvas => {
         const link = document.createElement('a');
         link.href = canvas.toDataURL('image/png');
         link.download = 'chart_high_res.png';
         link.click();
         });
         });

      </script>
   </body>
</html>
"""

        formatted_html = html_template.replace("@replace_ticker", ticker).replace("@replace_nci", final_nci_html_str).replace("@replace_ohlc", final_ohlc_html_str)


        # Check if html exists
        asset_type = i.split(':')[0]
        file_name = f"capital-trend-{ticker.lower()}.html"

        if asset_type == "ETF":
            # Check if the file exists
            if not os.path.exists(f"ETF/{file_name}"):
                # Create the file if it doesn't exist
                with open(f"ETF/{file_name}", 'w') as file:
                    file.write('')  # Creating an empty file
                file.close()

            with open(f"ETF/{file_name}", "w") as file:
                file.write(formatted_html)
            file.close()

        elif asset_type == "STOCK":
            # Check if the file exists
            if not os.path.exists(f"STOCK/{file_name}"):
                # Create the file if it doesn't exist
                with open(f"STOCK/{file_name}", 'w') as file:
                    file.write('')  # Creating an empty file
                file.close()
            with open(f"STOCK/{file_name}", "w") as file:
                file.write(formatted_html)
            file.close()
        print(file_name)
